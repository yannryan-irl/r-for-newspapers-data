<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Mapping with R: Geocode and Map the British Library’s Newspaper Collection | A short guide to using British Library Newspaper Data, using R</title>
  <meta name="description" content="This is a handbook to help new and existing users find, process and analyse historical newspaper data, using the programming language R, and its IDE R-Studio" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Mapping with R: Geocode and Map the British Library’s Newspaper Collection | A short guide to using British Library Newspaper Data, using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a handbook to help new and existing users find, process and analyse historical newspaper data, using the programming language R, and its IDE R-Studio" />
  <meta name="github-repo" content="yannryanBL/r-for-news-data" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Mapping with R: Geocode and Map the British Library’s Newspaper Collection | A short guide to using British Library Newspaper Data, using R" />
  
  <meta name="twitter:description" content="This is a handbook to help new and existing users find, process and analyse historical newspaper data, using the programming language R, and its IDE R-Studio" />
  

<meta name="author" content="Yann Ryan" />


<meta name="date" content="2020-04-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="quick-introduction-to-r-and-the-tidyverse.html"/>
<link rel="next" href="download-and-unzip-newspaper-files-using-r.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface &amp; Acknowledgements</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#unlocking-the-past-with-newspaper-data"><i class="fa fa-check"></i><b>2.1</b> Unlocking the past with newspaper data</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#what-can-you-do-with-newspaper-data"><i class="fa fa-check"></i><b>2.2</b> What can you do with newspaper data?</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#goals"><i class="fa fa-check"></i><b>2.3</b> Goals</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>2.4</b> Why R?</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#getting-started"><i class="fa fa-check"></i><b>2.5</b> Getting started</a><ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#download-r-and-r-studio"><i class="fa fa-check"></i><b>2.5.1</b> Download R and R-Studio</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#who-is-the-guide-for"><i class="fa fa-check"></i><b>2.6</b> Who is the guide for?</a></li>
<li class="chapter" data-level="2.7" data-path="introduction.html"><a href="introduction.html#format-of-the-book"><i class="fa fa-check"></i><b>2.7</b> Format of the book</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html"><i class="fa fa-check"></i><b>3</b> UK Newspaper Data</a><ul>
<li class="chapter" data-level="3.1" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#intro-to-british-library-newspapers"><i class="fa fa-check"></i><b>3.1</b> Intro to British Library Newspapers</a></li>
<li class="chapter" data-level="3.2" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#burney-collection"><i class="fa fa-check"></i><b>3.2</b> Burney Collection</a></li>
<li class="chapter" data-level="3.3" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#jisc-newspaper-digitisation-projects"><i class="fa fa-check"></i><b>3.3</b> JISC Newspaper digitisation projects</a></li>
<li class="chapter" data-level="3.4" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#british-newspaper-archive"><i class="fa fa-check"></i><b>3.4</b> British Newspaper Archive</a></li>
<li class="chapter" data-level="3.5" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#british-library-openly-available-newspaper-data"><i class="fa fa-check"></i><b>3.5</b> British Library Openly available newspaper data</a></li>
<li class="chapter" data-level="3.6" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#what-access-do-you-need"><i class="fa fa-check"></i><b>3.6</b> What access do you need?</a><ul>
<li class="chapter" data-level="3.6.1" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#you-want-to-find-individual-articles"><i class="fa fa-check"></i><b>3.6.1</b> You want to find individual articles?</a></li>
<li class="chapter" data-level="3.6.2" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#you-want-to-do-text-mining-on-a-large-corpus"><i class="fa fa-check"></i><b>3.6.2</b> You want to do text mining on a large corpus</a></li>
<li class="chapter" data-level="3.6.3" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#you-want-to-do-text-mining-on-the-entire-digitised-collection"><i class="fa fa-check"></i><b>3.6.3</b> You want to do text mining on the entire digitised collection</a></li>
<li class="chapter" data-level="3.6.4" data-path="uk-newspaper-data.html"><a href="uk-newspaper-data.html#you-want-to-do-something-involving-the-images-such-as-computer-vision-techniques"><i class="fa fa-check"></i><b>3.6.4</b> You want to do something involving the images, such as computer vision techniques,</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html"><i class="fa fa-check"></i><b>4</b> OCR and its problems</a><ul>
<li class="chapter" data-level="4.1" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#what-is-it-like-in-bl-newspapers"><i class="fa fa-check"></i><b>4.2</b> What is it like in BL newspapers?</a></li>
<li class="chapter" data-level="4.3" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#ocr-report-on-the-first-two-batches-of-content-on-the-bl-open-repository"><i class="fa fa-check"></i><b>4.3</b> OCR report on the first two batches of content on the BL Open Repository</a></li>
<li class="chapter" data-level="4.4" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#extract-predicted-word-scores-from-the-alto-pages"><i class="fa fa-check"></i><b>4.4</b> Extract predicted word scores from the ALTO pages</a></li>
<li class="chapter" data-level="4.5" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#visualisations"><i class="fa fa-check"></i><b>4.5</b> Visualisations:</a><ul>
<li class="chapter" data-level="4.5.1" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#whats-in-the-data"><i class="fa fa-check"></i><b>4.5.1</b> What’s in the data?</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#highest-and-lowest-results"><i class="fa fa-check"></i><b>4.6</b> Highest and lowest results:</a></li>
<li class="chapter" data-level="4.7" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#page-by-page-ocr-visualisation"><i class="fa fa-check"></i><b>4.7</b> Page-by-page OCR visualisation</a></li>
<li class="chapter" data-level="4.8" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#microfilm-vs-print"><i class="fa fa-check"></i><b>4.8</b> Microfilm vs print:</a></li>
<li class="chapter" data-level="4.9" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#conclusions"><i class="fa fa-check"></i><b>4.9</b> Conclusions</a></li>
<li class="chapter" data-level="4.10" data-path="ocr-and-its-problems.html"><a href="ocr-and-its-problems.html#impact-on-analysis"><i class="fa fa-check"></i><b>4.10</b> Impact on analysis</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html"><i class="fa fa-check"></i><b>5</b> Quick introduction to R and the tidyverse</a><ul>
<li class="chapter" data-level="5.1" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#what-is-r-and-why-should-you-use-it"><i class="fa fa-check"></i><b>5.1</b> What is R and why should you use it?</a></li>
<li class="chapter" data-level="5.2" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#using-r"><i class="fa fa-check"></i><b>5.2</b> Using R</a><ul>
<li class="chapter" data-level="5.2.1" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#base-r-commands"><i class="fa fa-check"></i><b>5.2.1</b> Base R commands</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#tidyverse"><i class="fa fa-check"></i><b>5.3</b> Tidyverse</a><ul>
<li class="chapter" data-level="5.3.1" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#select-pull"><i class="fa fa-check"></i><b>5.3.1</b> select(), pull()</a></li>
<li class="chapter" data-level="5.3.2" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#group_by-tally-summarise"><i class="fa fa-check"></i><b>5.3.2</b> group_by(), tally(), summarise()</a></li>
<li class="chapter" data-level="5.3.3" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#filter"><i class="fa fa-check"></i><b>5.3.3</b> filter()</a></li>
<li class="chapter" data-level="5.3.4" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#sort-arrange-top_n"><i class="fa fa-check"></i><b>5.3.4</b> sort(), arrange(), top_n()</a></li>
<li class="chapter" data-level="5.3.5" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#left_join-inner_join-anti_join"><i class="fa fa-check"></i><b>5.3.5</b> left_join(), inner_join(), anti_join()</a></li>
<li class="chapter" data-level="5.3.6" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#piping"><i class="fa fa-check"></i><b>5.3.6</b> Piping</a></li>
<li class="chapter" data-level="5.3.7" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#plotting-using-ggplot"><i class="fa fa-check"></i><b>5.3.7</b> Plotting using ggplot()</a></li>
<li class="chapter" data-level="5.3.8" data-path="quick-introduction-to-r-and-the-tidyverse.html"><a href="quick-introduction-to-r-and-the-tidyverse.html#doing-this-with-newspaper-data"><i class="fa fa-check"></i><b>5.3.8</b> Doing this with newspaper data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><i class="fa fa-check"></i><b>6</b> Mapping with R: Geocode and Map the British Library’s Newspaper Collection</a><ul>
<li class="chapter" data-level="6.1" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#mapping-with-ggplot2-and-mapdata"><i class="fa fa-check"></i><b>6.1</b> Mapping with ggplot2 and mapdata</a><ul>
<li class="chapter" data-level="6.1.1" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#a-map-of-british-newspapers-by-city"><i class="fa fa-check"></i><b>6.1.1</b> A map of British Newspapers by City</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#drawing-a-background-map."><i class="fa fa-check"></i><b>6.2</b> Drawing a background map. `</a></li>
<li class="chapter" data-level="6.3" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#add-sized-points-by-coordinates"><i class="fa fa-check"></i><b>6.3</b> Add Sized Points By Coordinates</a><ul>
<li class="chapter" data-level="6.3.1" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#get-a-count-of-the-total-titles-for-each-city"><i class="fa fa-check"></i><b>6.3.1</b> Get a count of the total titles for each city</a></li>
<li class="chapter" data-level="6.3.2" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#get-hold-of-a-list-of-geocoordinates"><i class="fa fa-check"></i><b>6.3.2</b> Get hold of a list of geocoordinates</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#bringing-it-all-together"><i class="fa fa-check"></i><b>6.4</b> Bringing it all together</a></li>
<li class="chapter" data-level="6.5" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#drawing-a-newspaper-titles-choropleth-map-with-r-and-the-sf-package"><i class="fa fa-check"></i><b>6.5</b> Drawing a newspaper titles ‘Choropleth’ map with R and the sf package</a></li>
<li class="chapter" data-level="6.6" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#get-county-information-from-the-title-list"><i class="fa fa-check"></i><b>6.6</b> Get county information from the title list</a></li>
<li class="chapter" data-level="6.7" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#make-the-points-object-using-geom_sf"><i class="fa fa-check"></i><b>6.7</b> Make the points object using geom_sf()</a><ul>
<li class="chapter" data-level="6.7.1" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#download-shapefiles"><i class="fa fa-check"></i><b>6.7.1</b> Download shapefiles</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#transform-from-utm-to-latlong-using-st_transform"><i class="fa fa-check"></i><b>6.8</b> Transform from UTM to lat/long using st_transform()</a></li>
<li class="chapter" data-level="6.9" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#download-and-merge-the-title-list-with-a-set-of-coordinates."><i class="fa fa-check"></i><b>6.9</b> Download and merge the title list with a set of coordinates.</a></li>
<li class="chapter" data-level="6.10" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#using-st_join-to-connect-the-title-list-to-the-shapefile"><i class="fa fa-check"></i><b>6.10</b> Using st_join to connect the title list to the shapefile</a></li>
<li class="chapter" data-level="6.11" data-path="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html"><a href="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection.html#draw-using-ggplot2-and-geom_sf"><i class="fa fa-check"></i><b>6.11</b> Draw using ggplot2 and geom_sf()</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="download-and-unzip-newspaper-files-using-r.html"><a href="download-and-unzip-newspaper-files-using-r.html"><i class="fa fa-check"></i><b>7</b> Download and Unzip Newspaper Files Using R</a><ul>
<li class="chapter" data-level="7.1" data-path="download-and-unzip-newspaper-files-using-r.html"><a href="download-and-unzip-newspaper-files-using-r.html#download-a-set-of-newspaper-files-from-the-british-librarys-open-repository"><i class="fa fa-check"></i><b>7.1</b> Download a set of newspaper files from the British Library’s open repository</a></li>
<li class="chapter" data-level="7.2" data-path="download-and-unzip-newspaper-files-using-r.html"><a href="download-and-unzip-newspaper-files-using-r.html#folder-structure"><i class="fa fa-check"></i><b>7.2</b> Folder structure</a></li>
<li class="chapter" data-level="7.3" data-path="download-and-unzip-newspaper-files-using-r.html"><a href="download-and-unzip-newspaper-files-using-r.html#contruct-a-corpus"><i class="fa fa-check"></i><b>7.3</b> Contruct a Corpus</a></li>
<li class="chapter" data-level="7.4" data-path="download-and-unzip-newspaper-files-using-r.html"><a href="download-and-unzip-newspaper-files-using-r.html#bulk-extract-the-files-using-unzip-and-a-for-loop"><i class="fa fa-check"></i><b>7.4</b> Bulk extract the files using unzip() and a for() loop</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="extract-text.html"><a href="extract-text.html"><i class="fa fa-check"></i><b>8</b> Make a Text Corpus</a><ul>
<li class="chapter" data-level="8.1" data-path="extract-text.html"><a href="extract-text.html#where-is-this-data"><i class="fa fa-check"></i><b>8.1</b> Where is this data?</a></li>
<li class="chapter" data-level="8.2" data-path="extract-text.html"><a href="extract-text.html#folder-structure-1"><i class="fa fa-check"></i><b>8.2</b> Folder structure</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="term-frequencies.html"><a href="term-frequencies.html"><i class="fa fa-check"></i><b>9</b> Term Frequencies</a><ul>
<li class="chapter" data-level="9.1" data-path="term-frequencies.html"><a href="term-frequencies.html#load-the-news-dataframe-and-relevant-libraries"><i class="fa fa-check"></i><b>9.1</b> Load the news dataframe and relevant libraries</a></li>
<li class="chapter" data-level="9.2" data-path="term-frequencies.html"><a href="term-frequencies.html#tokenise-the-text-using-unnest_tokens"><i class="fa fa-check"></i><b>9.2</b> Tokenise the text using unnest_tokens()</a></li>
<li class="chapter" data-level="9.3" data-path="term-frequencies.html"><a href="term-frequencies.html#pre-process-to-clean-and-remove-stop-words"><i class="fa fa-check"></i><b>9.3</b> Pre-process to clean and remove stop words</a></li>
<li class="chapter" data-level="9.4" data-path="term-frequencies.html"><a href="term-frequencies.html#create-and-save-a-dataset-of-tokenised-text"><i class="fa fa-check"></i><b>9.4</b> Create and save a dataset of tokenised text</a></li>
<li class="chapter" data-level="9.5" data-path="term-frequencies.html"><a href="term-frequencies.html#count-the-tokens"><i class="fa fa-check"></i><b>9.5</b> Count the tokens</a><ul>
<li class="chapter" data-level="9.5.1" data-path="term-frequencies.html"><a href="term-frequencies.html#the-top-words-overall"><i class="fa fa-check"></i><b>9.5.1</b> The top words overall:</a></li>
<li class="chapter" data-level="9.5.2" data-path="term-frequencies.html"><a href="term-frequencies.html#the-top-five-words-for-each-day-in-the-dataset"><i class="fa fa-check"></i><b>9.5.2</b> The top five words for each day in the dataset:</a></li>
<li class="chapter" data-level="9.5.3" data-path="term-frequencies.html"><a href="term-frequencies.html#check-the-top-words-per-title-well-variant-titles-in-this-case"><i class="fa fa-check"></i><b>9.5.3</b> Check the top words per title (well, variant titles in this case):</a></li>
<li class="chapter" data-level="9.5.4" data-path="term-frequencies.html"><a href="term-frequencies.html#top-words-by-year"><i class="fa fa-check"></i><b>9.5.4</b> Top words by year</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="term-frequencies.html"><a href="term-frequencies.html#visualise-the-results"><i class="fa fa-check"></i><b>9.6</b> Visualise the Results</a><ul>
<li class="chapter" data-level="9.6.1" data-path="term-frequencies.html"><a href="term-frequencies.html#words-over-time"><i class="fa fa-check"></i><b>9.6.1</b> Words over time</a></li>
<li class="chapter" data-level="9.6.2" data-path="term-frequencies.html"><a href="term-frequencies.html#chart-several-words-over-time"><i class="fa fa-check"></i><b>9.6.2</b> Chart several words over time</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="term-frequencies.html"><a href="term-frequencies.html#further-reading"><i class="fa fa-check"></i><b>9.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="calculating-tf-idf-scores-with-tidytext.html"><a href="calculating-tf-idf-scores-with-tidytext.html"><i class="fa fa-check"></i><b>10</b> Calculating tf-idf Scores with Tidytext</a></li>
<li class="chapter" data-level="11" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html"><i class="fa fa-check"></i><b>11</b> Sentiment analysis</a><ul>
<li class="chapter" data-level="11.1" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#install-and-load-relevant-packages"><i class="fa fa-check"></i><b>11.1</b> Install and load relevant packages</a></li>
<li class="chapter" data-level="11.2" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#fetch-sentiment-data"><i class="fa fa-check"></i><b>11.2</b> Fetch sentiment data</a><ul>
<li class="chapter" data-level="11.2.1" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#afinn-dataset"><i class="fa fa-check"></i><b>11.2.1</b> Afinn dataset</a></li>
<li class="chapter" data-level="11.2.2" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#bing-dataset"><i class="fa fa-check"></i><b>11.2.2</b> Bing dataset</a></li>
<li class="chapter" data-level="11.2.3" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#loughran-dataset"><i class="fa fa-check"></i><b>11.2.3</b> Loughran dataset</a></li>
<li class="chapter" data-level="11.2.4" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#nrc-dataset"><i class="fa fa-check"></i><b>11.2.4</b> NRC dataset</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#load-the-tokenised-news-sample"><i class="fa fa-check"></i><b>11.3</b> Load the tokenised news sample</a></li>
<li class="chapter" data-level="11.4" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#charting-changes-in-sentiment-over-time"><i class="fa fa-check"></i><b>11.4</b> Charting Changes in Sentiment Over Time</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="topic-modelling.html"><a href="topic-modelling.html"><i class="fa fa-check"></i><b>12</b> Topic modelling</a><ul>
<li class="chapter" data-level="12.1" data-path="topic-modelling.html"><a href="topic-modelling.html#topic-modelling-with-the-library-topicmodels"><i class="fa fa-check"></i><b>12.1</b> Topic modelling with the library ‘topicmodels’</a></li>
<li class="chapter" data-level="12.2" data-path="topic-modelling.html"><a href="topic-modelling.html#load-the-tokenised-dataframe"><i class="fa fa-check"></i><b>12.2</b> Load the tokenised dataframe</a></li>
<li class="chapter" data-level="12.3" data-path="topic-modelling.html"><a href="topic-modelling.html#create-a-dataframe-of-word-counts-with-tf_idf-scores"><i class="fa fa-check"></i><b>12.3</b> Create a dataframe of word counts with tf_idf scores</a></li>
<li class="chapter" data-level="12.4" data-path="topic-modelling.html"><a href="topic-modelling.html#make-a-document-term-matrix"><i class="fa fa-check"></i><b>12.4</b> Make a ‘document term matrix’</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html"><i class="fa fa-check"></i><b>13</b> Detecting text reuse in newspaper articles.</a><ul>
<li class="chapter" data-level="13.1" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#turn-the-newspaper-sample-into-a-bunch-of-text-documents-one-per-article"><i class="fa fa-check"></i><b>13.1</b> Turn the newspaper sample into a bunch of text documents, one per article</a><ul>
<li class="chapter" data-level="13.1.1" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#load-the-dataframe-and-preprocess"><i class="fa fa-check"></i><b>13.1.1</b> Load the dataframe and preprocess</a></li>
<li class="chapter" data-level="13.1.2" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#make-a-text-file-from-each-article"><i class="fa fa-check"></i><b>13.1.2</b> Make a text file from each article</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#load-the-files-as-a-textreusecorpus"><i class="fa fa-check"></i><b>13.2</b> Load the files as a TextReuseCorpus</a><ul>
<li class="chapter" data-level="13.2.1" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#generate-a-minhash"><i class="fa fa-check"></i><b>13.2.1</b> Generate a minhash</a></li>
<li class="chapter" data-level="13.2.2" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#create-the-textreusecorpus"><i class="fa fa-check"></i><b>13.2.2</b> Create the TextReuseCorpus</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="detecting-text-reuse-in-newspaper-articles-.html"><a href="detecting-text-reuse-in-newspaper-articles-.html#further-reading-1"><i class="fa fa-check"></i><b>13.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="further-reading-2.html"><a href="further-reading-2.html"><i class="fa fa-check"></i><b>14</b> Further reading</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A short guide to using British Library Newspaper Data, using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapping-with-r-geocode-and-map-the-british-librarys-newspaper-collection" class="section level1">
<h1><span class="header-section-number">6</span> Mapping with R: Geocode and Map the British Library’s Newspaper Collection</h1>
<p>R is great for making maps, whether for visualising historical material or doing more advanced analysis. Using an openly available list of British Library titles, with some additional coordinate information, it’s possible to very quickly make high-quality, publishable maps.</p>
<div class="figure"><span id="fig:unnamed-chunk-63"></span>
<img src="title_list_map.png" alt="British Library newspaper titles, mapped by city. Maps like this are easy to produce using R."  />
<p class="caption">
Figure 6.1: British Library newspaper titles, mapped by city. Maps like this are easy to produce using R.
</p>
</div>
<div id="mapping-with-ggplot2-and-mapdata" class="section level2">
<h2><span class="header-section-number">6.1</span> Mapping with ggplot2 and mapdata</h2>
<div id="a-map-of-british-newspapers-by-city" class="section level3">
<h3><span class="header-section-number">6.1.1</span> A map of British Newspapers by City</h3>
<p>With R and ggplot2, it’s possible to quickly map and understand the geographic coverage of the newspapers held by the British Library.</p>
<p>To do this we’ll need three elements:</p>
<ul>
<li><p>A background map of the UK and Ireland</p></li>
<li><p>A count of the total titles for each city</p></li>
<li><p>A list of coordinates for each place mentioned in the title list.</p></li>
</ul>
</div>
</div>
<div id="drawing-a-background-map." class="section level2">
<h2><span class="header-section-number">6.2</span> Drawing a background map. `</h2>
<p>The first thing needed, is a background back of the UK, to which points, sized by number of titles, will be added.</p>
<p>The plotting library <em>ggplot2</em>, which is part of the tidyverse package, contains a function called <code>map_data()</code> which turns data from the <em>maps</em> library into a dataframe. The usual functions of ggplot2 can then be used to draw a map. First you’ll need to install the maps package using <code>install.packages()</code>. This package contains the actual data which can then be called with the ggplot2 function <code>map_data()</code>.</p>
<p>Next load <em>ggplot2</em> and the <em>maps</em> library</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="kw">library</span>(maps)</a></code></pre></div>
<p>First create a dataframe called ‘worldmap’ with a function called <code>map_data()</code>. <code>map_data()</code> takes an argument with the name of the map you want to load, in inverted commas. Some of the choices are ‘world’, ‘usa’, ‘france’, ‘italy’. We’ll use the ‘world’ map.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">worldmap =<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&#39;world&#39;</span>)</a></code></pre></div>
<p>Take a look at the dataframe we’ve created:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(worldmap, <span class="dv">20</span>))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">long</th>
<th align="right">lat</th>
<th align="right">group</th>
<th align="right">order</th>
<th align="left">region</th>
<th align="left">subregion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="right">-69.89912</td>
<td align="right">12.45200</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>2</td>
<td align="right">-69.89571</td>
<td align="right">12.42300</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="right">-69.94219</td>
<td align="right">12.43853</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>4</td>
<td align="right">-70.00415</td>
<td align="right">12.50049</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>5</td>
<td align="right">-70.06612</td>
<td align="right">12.54697</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>6</td>
<td align="right">-70.05088</td>
<td align="right">12.59707</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>7</td>
<td align="right">-70.03511</td>
<td align="right">12.61411</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>8</td>
<td align="right">-69.97314</td>
<td align="right">12.56763</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>9</td>
<td align="right">-69.91181</td>
<td align="right">12.48047</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>10</td>
<td align="right">-69.89912</td>
<td align="right">12.45200</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="left">Aruba</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>12</td>
<td align="right">74.89131</td>
<td align="right">37.23164</td>
<td align="right">2</td>
<td align="right">12</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>13</td>
<td align="right">74.84023</td>
<td align="right">37.22505</td>
<td align="right">2</td>
<td align="right">13</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>14</td>
<td align="right">74.76738</td>
<td align="right">37.24917</td>
<td align="right">2</td>
<td align="right">14</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>15</td>
<td align="right">74.73896</td>
<td align="right">37.28564</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>16</td>
<td align="right">74.72666</td>
<td align="right">37.29072</td>
<td align="right">2</td>
<td align="right">16</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>17</td>
<td align="right">74.66895</td>
<td align="right">37.26670</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>18</td>
<td align="right">74.55899</td>
<td align="right">37.23662</td>
<td align="right">2</td>
<td align="right">18</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>19</td>
<td align="right">74.37217</td>
<td align="right">37.15771</td>
<td align="right">2</td>
<td align="right">19</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td>20</td>
<td align="right">74.37617</td>
<td align="right">37.13735</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td>21</td>
<td align="right">74.49796</td>
<td align="right">37.05722</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="left">Afghanistan</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>It’s a big table with about 100,000 rows. Each row has a latitude and longitude, and a group. Each region and sub-region in the dataframe has its own group number. We’ll use a function <code>geom_polygon</code> which tells ggplot to draw a polygon (a bunch of connected lines) for each group, and display it.</p>
<p>With the <code>aes()</code>, x tells ggplot2 the longitude of each point, y the latitude, and group makes sure the polygons are grouped together correctly.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, </a>
<a class="sourceLine" id="cb54-3" data-line-number="3">                        <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="768" /></p>
<p>Right, it needs a <em>bit</em> of tweaking. First, we only want to plot points in the UK. There’s obviously way too much map for this, so the first thing we should do is restrict it to a rectangle which includes those two countries.</p>
<p>We can do that with <code>coord_fixed()</code>. <code>coord_fixed()</code> is used to fix the aspect ratio of a coordinate system, but can be used to specify a bounding box by using two of its arguments: <code>xlim=</code> and <code>ylim=</code>. These each take a vector (a series of numbers) with two items A vector is created using <code>c()</code>. Each item in the vector specifies the limits for that axis. So <code>xlim = c(0,10)</code> means <em>restrict the x-axis to 0 and 10</em>. The axes correspond to the lines of longitude (x) and latitude (y). We’ll restrict the x-axis to c(-10, 4) and the y-axis to c(50.3, 60) which should just about cover the UK and Ireland.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, </a>
<a class="sourceLine" id="cb55-2" data-line-number="2">                        <span class="kw">aes</span>(<span class="dt">x =</span> long, </a>
<a class="sourceLine" id="cb55-3" data-line-number="3">                            <span class="dt">y =</span> lat, </a>
<a class="sourceLine" id="cb55-4" data-line-number="4">                            <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb55-6" data-line-number="6">              <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">50.3</span>, <span class="dv">59</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-68"></span>
<img src="_main_files/figure-html/unnamed-chunk-68-1.png" alt="Empty Map" width="768" />
<p class="caption">
Figure 6.2: Empty Map
</p>
</div>
<p>You can also change the aspect ratio of the coordinates using another ggplot function, <code>coord_fixed()</code>. The default is 1, but by specifying a different one with the argument <code>ratio =</code>, that can be changed. Using <code>ratio = 1.3</code> results in a less squashed-looking map.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, </a>
<a class="sourceLine" id="cb56-3" data-line-number="3">               <span class="kw">aes</span>(<span class="dt">x =</span> long, </a>
<a class="sourceLine" id="cb56-4" data-line-number="4">                   <span class="dt">y =</span> lat, </a>
<a class="sourceLine" id="cb56-5" data-line-number="5">                   <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="fl">1.3</span>, </a>
<a class="sourceLine" id="cb56-7" data-line-number="7">              <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb56-8" data-line-number="8">              <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">59</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-69"></span>
<img src="_main_files/figure-html/unnamed-chunk-69-1.png" alt="Aspect Ratio Adjustment" width="768" />
<p class="caption">
Figure 6.3: Aspect Ratio Adjustment
</p>
</div>
<p>A couple more things, which I’ll run through quickly.</p>
<p>You can specify fill and line colors usings <code>fill =</code> and <code>color =</code> inside <code>geom_polygon()</code> but <em>outside</em> <code>aes()</code>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, </a>
<a class="sourceLine" id="cb57-3" data-line-number="3">               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, </a>
<a class="sourceLine" id="cb57-4" data-line-number="4">                   <span class="dt">group =</span> group), </a>
<a class="sourceLine" id="cb57-5" data-line-number="5">               <span class="dt">fill =</span> <span class="st">&#39;gray90&#39;</span>, </a>
<a class="sourceLine" id="cb57-6" data-line-number="6">               <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb57-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="fl">1.3</span>, </a>
<a class="sourceLine" id="cb57-8" data-line-number="8">              <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb57-9" data-line-number="9">              <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">59</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-70"></span>
<img src="_main_files/figure-html/unnamed-chunk-70-1.png" alt="Colours and Fill" width="768" />
<p class="caption">
Figure 6.4: Colours and Fill
</p>
</div>
<p>We probably don’t need the grids or panels in the background. We can get rid of these with <code>+ theme_void()</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, </a>
<a class="sourceLine" id="cb58-3" data-line-number="3">               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, </a>
<a class="sourceLine" id="cb58-4" data-line-number="4">                   <span class="dt">group =</span> group), </a>
<a class="sourceLine" id="cb58-5" data-line-number="5">               <span class="dt">fill =</span> <span class="st">&#39;gray90&#39;</span>, </a>
<a class="sourceLine" id="cb58-6" data-line-number="6">               <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="fl">1.3</span>, </a>
<a class="sourceLine" id="cb58-8" data-line-number="8">              <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb58-9" data-line-number="9">              <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">59</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_void</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-71-1.png" width="768" /></p>
</div>
<div id="add-sized-points-by-coordinates" class="section level2">
<h2><span class="header-section-number">6.3</span> Add Sized Points By Coordinates</h2>
<div id="get-a-count-of-the-total-titles-for-each-city" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Get a count of the total titles for each city</h3>
<p>This next bit uses some of the functions demonstrated in the introduction to R and the tidyverse, namely <code>group_by()</code> and <code>tally()</code>.</p>
<p>First load the rest of the tidyverse packages.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>Next, load the title list, which can be dowloaded from the <a href="https://doi.org/10.23636/1136">British Library’s Open Repository</a></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">title_list =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/BritishAndIrishNewspapersTitleList_20191118.csv&#39;</span>)</a></code></pre></div>
<p>We can quite easily make a new data frame, which will just include each location and the total number of instances in the dataset.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">location_counts =<span class="st"> </span>title_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country_of_publication, </a>
<a class="sourceLine" id="cb61-3" data-line-number="3">           general_area_of_coverage, </a>
<a class="sourceLine" id="cb61-4" data-line-number="4">           coverage_city) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="st">  </span><span class="kw">tally</span>()</a></code></pre></div>
<p>Arranging these in descending order of their count shows how many of each we have:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(location_counts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">country_of_publication</th>
<th align="left">general_area_of_coverage</th>
<th align="left">coverage_city</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">England</td>
<td align="left">London</td>
<td align="left">London</td>
<td align="right">5781</td>
</tr>
<tr class="even">
<td align="left">Ireland</td>
<td align="left">Dublin (Ireland : County)</td>
<td align="left">Dublin</td>
<td align="right">415</td>
</tr>
<tr class="odd">
<td align="left">Scotland</td>
<td align="left">Strathclyde</td>
<td align="left">Glasgow</td>
<td align="right">309</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">Greater Manchester</td>
<td align="left">Manchester</td>
<td align="right">265</td>
</tr>
<tr class="odd">
<td align="left">England</td>
<td align="left">West Midlands</td>
<td align="left">Birmingham</td>
<td align="right">260</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">Merseyside</td>
<td align="left">Liverpool</td>
<td align="right">220</td>
</tr>
<tr class="odd">
<td align="left">England</td>
<td align="left">Avon</td>
<td align="left">Bristol</td>
<td align="right">175</td>
</tr>
<tr class="even">
<td align="left">Scotland</td>
<td align="left">Lothian</td>
<td align="left">Edinburgh</td>
<td align="right">162</td>
</tr>
<tr class="odd">
<td align="left">England</td>
<td align="left">South Yorkshire</td>
<td align="left">Sheffield</td>
<td align="right">133</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">Nottinghamshire</td>
<td align="left">Nottingham</td>
<td align="right">127</td>
</tr>
</tbody>
</table>
</div>
<div id="get-hold-of-a-list-of-geocoordinates" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Get hold of a list of geocoordinates</h3>
<p>These coordinates have been produced in cooperation with another project with the Library, <em>Living with Machines</em>. We used smart annotations to quickly correct and train a georeferencer, to generate coordinates with much higher accuracy than, say, geonames or a google georeferencer. These can be joined to the title list downloaded from the repository, and then easily mapped.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">geocorrected =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/geocorrected.csv&#39;</span>)</a></code></pre></div>
<p>Change the column names:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">library</span>(snakecase)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="kw">colnames</span>(geocorrected) =<span class="st"> </span><span class="kw">to_snake_case</span>(<span class="kw">colnames</span>(geocorrected))</a></code></pre></div>
<p>Do a bit of pre-processing to this. Change some column names further, select just the relevant columns, change the NA values and get rid of any empty entries.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">colnames</span>(geocorrected)[<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wikititle&#39;</span>, </a>
<a class="sourceLine" id="cb65-2" data-line-number="2">                                <span class="st">&#39;lat&#39;</span>, </a>
<a class="sourceLine" id="cb65-3" data-line-number="3">                                <span class="st">&#39;lng&#39;</span>)</a>
<a class="sourceLine" id="cb65-4" data-line-number="4"></a>
<a class="sourceLine" id="cb65-5" data-line-number="5">geocorrected =<span class="st"> </span>geocorrected <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-9</span>,<span class="op">-</span><span class="dv">10</span>, <span class="dv">-11</span>, <span class="dv">-12</span>)</a>
<a class="sourceLine" id="cb65-7" data-line-number="7"></a>
<a class="sourceLine" id="cb65-8" data-line-number="8">geocorrected =<span class="st"> </span>geocorrected <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country_of_publication =</span> <span class="kw">replace</span>(country_of_publication, </a>
<a class="sourceLine" id="cb65-10" data-line-number="10">                                          country_of_publication <span class="op">==</span><span class="st"> &#39;na&#39;</span>, <span class="ot">NA</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">general_area_of_coverage =</span> <span class="kw">replace</span>(general_area_of_coverage,</a>
<a class="sourceLine" id="cb65-12" data-line-number="12">                                            general_area_of_coverage <span class="op">==</span><span class="st"> &#39;na&#39;</span>, <span class="ot">NA</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">coverage_city =</span> <span class="kw">replace</span>(coverage_city,</a>
<a class="sourceLine" id="cb65-14" data-line-number="14">                                 coverage_city <span class="op">==</span><span class="st"> &#39;na&#39;</span>, <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb65-15" data-line-number="15"></a>
<a class="sourceLine" id="cb65-16" data-line-number="16">geocorrected =<span class="st"> </span>geocorrected <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lat =</span> <span class="kw">as.numeric</span>(lat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lng =</span> <span class="kw">as.numeric</span>(lng)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-19" data-line-number="19"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lat)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lng))</a></code></pre></div>
<p>The result is a dataframe with a set of longitude and latitude points (they come from Wikipedia, which is why they are prefixed with <em>wiki</em>) for every combination of city/county/country in the list of titles. These can be joined to the full title list with the following method:</p>
<p>Using <code>left_join()</code> we will merge these dataframes, joining up each set of location information to its coordinates and standardised name. <code>left_join()</code> is a <em>very</em> common command in data analysis. It merges two sets of data by matching a value known as a key.</p>
<p>Here the key is three values - city, county and country, and it matches up the two sets of data by ‘joining’ two rows together, if they share all three of these values. Store this is a new variable called <code>lc_with_geo</code>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">lc_with_geo =<span class="st"> </span>location_counts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(geocorrected, </a>
<a class="sourceLine" id="cb66-3" data-line-number="3">            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;coverage_city&#39;</span> ,</a>
<a class="sourceLine" id="cb66-4" data-line-number="4">                   <span class="st">&#39;general_area_of_coverage&#39;</span>,</a>
<a class="sourceLine" id="cb66-5" data-line-number="5">                   <span class="st">&#39;country_of_publication&#39;</span>))</a></code></pre></div>
<p>If you look at this new dataset, you’ll see that now the counts of locations have merged with the geocorrected data. Now we have an amount and coordinates for each place.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">head</span>(lc_with_geo, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
## # Groups:   country_of_publication, general_area_of_coverage [9]
##    country_of_publ… general_area_of… coverage_city     n places wikititle   lat
##    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
##  1 Bermuda Islands  &lt;NA&gt;             Hamilton         23 &lt;NA&gt;   &lt;NA&gt;         NA
##  2 Bermuda Islands  &lt;NA&gt;             Saint George      1 &lt;NA&gt;   &lt;NA&gt;         NA
##  3 Cayman Islands   &lt;NA&gt;             Georgetown        1 &lt;NA&gt;   &lt;NA&gt;         NA
##  4 England          Aberdeenshire (… Peterhead         1 &lt;NA&gt;   &lt;NA&gt;         NA
##  5 England          Acton (London, … Ealing (Lond…     1 &lt;NA&gt;   &lt;NA&gt;         NA
##  6 England          Aintree  |Merse… Maghull           3 &lt;NA&gt;   &lt;NA&gt;         NA
##  7 England          Alford (Lincoln… Mablethorpe       1 &lt;NA&gt;   &lt;NA&gt;         NA
##  8 England          Alford (Lincoln… Skegness          1 &lt;NA&gt;   &lt;NA&gt;         NA
##  9 England          Alfriston  |Eas… Newhaven          1 &lt;NA&gt;   &lt;NA&gt;         NA
## 10 England          Altrincham  |Gr… Sale              2 &lt;NA&gt;   &lt;NA&gt;         NA
## # … with 1 more variable: lng &lt;dbl&gt;</code></pre>
<p>Right, now we’re going to use <code>group_by()</code> and <code>tally()</code> again, this time on the the <em>wikititle</em>, <em>wikilat</em> and <em>wikilon</em> columns. This is because the wikititle is a standardised title, which means it will group together cities properly, rather than giving a different row for slightly different combinations of the three geographic information columns (incidentally, it could also be used to link to wikidata)</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">lc_with_geo_counts =<span class="st"> </span>lc_with_geo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(wikititle, lat, lng) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="st">  </span><span class="kw">tally</span>(n)</a></code></pre></div>
<p>Now we’ve got a dataframe with counts of total newspapers, for each standardised wikipedia title in the dataset.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(lc_with_geo_counts,<span class="dv">10</span>))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">wikititle</th>
<th align="right">lat</th>
<th align="right">lng</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Abbots_Langley</td>
<td align="right">51.7010</td>
<td align="right">-0.4160</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Aberavon_(UK_Parliament_constituency)</td>
<td align="right">51.6000</td>
<td align="right">-3.8120</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Aberdare</td>
<td align="right">51.7130</td>
<td align="right">-3.4450</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">Aberdeen</td>
<td align="right">57.1500</td>
<td align="right">-2.1100</td>
<td align="right">82</td>
</tr>
<tr class="odd">
<td align="left">Abergavenny</td>
<td align="right">51.8240</td>
<td align="right">-3.0167</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Abergele</td>
<td align="right">53.2800</td>
<td align="right">-3.5800</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">Abersychan</td>
<td align="right">51.7239</td>
<td align="right">-3.0587</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Abertillery</td>
<td align="right">51.7300</td>
<td align="right">-3.1300</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Aberystwyth</td>
<td align="right">52.4140</td>
<td align="right">-4.0810</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="left">Abingdon-on-Thames</td>
<td align="right">51.6670</td>
<td align="right">-1.2830</td>
<td align="right">23</td>
</tr>
</tbody>
</table>
<p>OK, lc_with_geo_counts is what we want to plot. This contains the city title, coordinates and counts for all the relevant places in our dataset. But first we need the map we created earlier.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, <span class="kw">aes</span>(<span class="dt">x =</span> long, </a>
<a class="sourceLine" id="cb71-3" data-line-number="3">                                    <span class="dt">y =</span> lat, </a>
<a class="sourceLine" id="cb71-4" data-line-number="4">                                    <span class="dt">group =</span> group), </a>
<a class="sourceLine" id="cb71-5" data-line-number="5">               <span class="dt">fill =</span> <span class="st">&#39;gray90&#39;</span>, </a>
<a class="sourceLine" id="cb71-6" data-line-number="6">               <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="fl">1.3</span>, </a>
<a class="sourceLine" id="cb71-8" data-line-number="8">              <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb71-9" data-line-number="9">              <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">59</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_void</span>()</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-83"></span>
<img src="_main_files/figure-html/unnamed-chunk-83-1.png" alt="Blank Map of UK and Ireland" width="768" />
<p class="caption">
Figure 6.5: Blank Map of UK and Ireland
</p>
</div>
</div>
</div>
<div id="bringing-it-all-together" class="section level2">
<h2><span class="header-section-number">6.4</span> Bringing it all together</h2>
<p>Now we will plot the cities using <code>geom_point()</code> We’ll specify the <code>lc_with_geo_counts</code> as the argument to <code>data =</code> within <code>geom_point()</code>. The x axis position of each point is the longitude, and the y axis the latitude. We’ll also use the argument <code>size = n</code> within the <code>aes()</code>, to tell ggplot2 to size the points by the column n, which contains the counts for each of our locations, and the argument <code>alpha = .7</code> outside the <code>aes()</code>, to make the points more transparent and slightly easier to read overlapping ones.</p>
<p>One last thing we’ll add is <code>+scale_size_area()</code>. This sizes the points using their radius rather than diameter, which is a more correct way of representing numbers using circles!</p>
<p>Using <code>labs()</code>, add a title, and with <code>scale_size_area()</code> and <code>scale_color_viridis_c()</code>, make some changes to the size and colours, respectively.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> worldmap, </a>
<a class="sourceLine" id="cb72-3" data-line-number="3">               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), </a>
<a class="sourceLine" id="cb72-4" data-line-number="4">               <span class="dt">fill =</span> <span class="st">&#39;gray90&#39;</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="fl">1.3</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">3</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">59</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> lc_with_geo_counts, </a>
<a class="sourceLine" id="cb72-8" data-line-number="8">             <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(lng), </a>
<a class="sourceLine" id="cb72-9" data-line-number="9">                 <span class="dt">y =</span> <span class="kw">as.numeric</span>(lat), <span class="dt">size =</span> n, <span class="dt">color =</span> <span class="kw">log</span>(n)), <span class="dt">alpha =</span> <span class="fl">.7</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">8</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;none&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-84"></span>
<img src="_main_files/figure-html/unnamed-chunk-84-1.png" alt="Finished Map" width="768" />
<p class="caption">
Figure 6.6: Finished Map
</p>
</div>
</div>
<div id="drawing-a-newspaper-titles-choropleth-map-with-r-and-the-sf-package" class="section level2">
<h2><span class="header-section-number">6.5</span> Drawing a newspaper titles ‘Choropleth’ map with R and the sf package</h2>
<p><img src="choropleth.png" /></p>
<p>Another type of map is known as a ‘choropleth’. This is where the data is visualised by a certain polygon area rather than a point. Typically these represent areas like parishes, counties or countries. Using the library <code>sf</code>, which stands for Simple Features, a choropleth map can be made quite quickly. A choropleth map uses a shapefile, which is a list of polygons and a <em>projection</em>.</p>
<p>The trick here is to use the coordinates to correctly situate each set of points within the correct county, as found in the shapefile. Then, count up the titles by this corrected county, and use this total to color or shade the map. The good thing about this method is that once you have a set of coordinates, they can be situated within any shapefile - a historic map, for example. This is particularly useful for anything to do with English counties, which tend to be changed pretty regularly.</p>
<p>This section uses data from .visionofbritain.co.uk, which needs to be downloaded separately. You could also use the free boundary data here: <a href="https://www.ordnancesurvey.co.uk/business-government/products/boundaryline" class="uri">https://www.ordnancesurvey.co.uk/business-government/products/boundaryline</a>, which contains bondaries for both modern and historic counties. This is an excellent source, and the file includes a range of boundaries including counties but also districts and constituencies, under an ‘Open Government Licence’.
## Choropleth map steps</p>
<p>The steps to create this type of map:</p>
<ul>
<li>Download shapefiles for england and scotland from here</li>
<li>Turn into sf object
Download list of points, turn into sf object
Use st join to get county information
Join to the title list and deselect everything except county and titles - maybe 19th century only..
Join that to the sf object
Plot using geom_sf()</li>
</ul>
<p>Load libraries</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="kw">library</span>(sf)</a></code></pre></div>
</div>
<div id="get-county-information-from-the-title-list" class="section level2">
<h2><span class="header-section-number">6.6</span> Get county information from the title list</h2>
<p>Next, download (if you haven’t already) the title list from the British Library open repository.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">title_df =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/BritishAndIrishNewspapersTitleList_20191118.csv&#39;</span>)</a></code></pre></div>
</div>
<div id="make-the-points-object-using-geom_sf" class="section level2">
<h2><span class="header-section-number">6.7</span> Make the points object using geom_sf()</h2>
<div id="download-shapefiles" class="section level3">
<h3><span class="header-section-number">6.7.1</span> Download shapefiles</h3>
<p>First, download the relevant shapefiles. These don’t necessarily have to be historic ones. Use <code>st_read()</code> to read the file, specifying its path. Do this for England, Wales and Scotland (we don’t have points for Ireland).</p>
</div>
</div>
<div id="transform-from-utm-to-latlong-using-st_transform" class="section level2">
<h2><span class="header-section-number">6.8</span> Transform from UTM to lat/long using st_transform()</h2>
<p>These shapefiles use points system known as UTM, which stands for <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">‘Universal Transverse Mercator’</a>. According to wikipedia,</p>
<blockquote>
<p>it differs from global latitude/longitude in that it divides earth into 60 zones and projects each to the plane as a basis for its coordinates.</p>
</blockquote>
<p>It needs to be transformed into lat/long coordinates, because the coordinates we have are in that format. This is easy with <code>st_transform()</code>. To transform correctly, the correct crs is needed. This is the code for which of the 60 zones this UTM comes from. Britain is 4326.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">eng_<span class="dv">1851</span> =<span class="st"> </span><span class="kw">st_transform</span>(eng_<span class="dv">1851</span>, <span class="dt">crs =</span> <span class="dv">4326</span>)</a></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">scot_<span class="dv">1851</span>  =<span class="st"> </span><span class="kw">st_transform</span>(scot_<span class="dv">1851</span>, <span class="dt">crs =</span> <span class="dv">4326</span>)</a></code></pre></div>
<p>Bind them both together, using <code>rbind()</code> to make one big shapefile for Great Britain.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">gb1851 =<span class="st"> </span><span class="kw">rbind</span>(eng_<span class="dv">1851</span>, scot_<span class="dv">1851</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="st">                 </span><span class="kw">select</span>(<span class="op">-</span>UL_AUTH))</a></code></pre></div>
</div>
<div id="download-and-merge-the-title-list-with-a-set-of-coordinates." class="section level2">
<h2><span class="header-section-number">6.9</span> Download and merge the title list with a set of coordinates.</h2>
<p>Next, load and pre-process the set of coordinates:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">geocorrected =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/geocorrected.csv&#39;</span>)</a></code></pre></div>
<p>Change the column names:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">library</span>(snakecase)</a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="kw">colnames</span>(geocorrected) =<span class="st"> </span><span class="kw">to_snake_case</span>(<span class="kw">colnames</span>(geocorrected))</a></code></pre></div>
<p>Change some column names further, select just the relevant columns, change the NA values and get rid of any empty entries.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">colnames</span>(geocorrected)[<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;wikititle&#39;</span>, <span class="st">&#39;lat&#39;</span>, <span class="st">&#39;lng&#39;</span>)</a>
<a class="sourceLine" id="cb80-2" data-line-number="2"></a>
<a class="sourceLine" id="cb80-3" data-line-number="3">geocorrected =<span class="st"> </span>geocorrected <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-9</span>,<span class="op">-</span><span class="dv">10</span>, <span class="dv">-11</span>, <span class="dv">-12</span>)</a>
<a class="sourceLine" id="cb80-4" data-line-number="4"></a>
<a class="sourceLine" id="cb80-5" data-line-number="5">geocorrected =<span class="st"> </span>geocorrected <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country_of_publication =</span> <span class="kw">replace</span>(country_of_publication, </a>
<a class="sourceLine" id="cb80-7" data-line-number="7">                                          country_of_publication <span class="op">==</span><span class="st"> &#39;na&#39;</span>, <span class="ot">NA</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">general_area_of_coverage =</span> <span class="kw">replace</span>(general_area_of_coverage,</a>
<a class="sourceLine" id="cb80-8" data-line-number="8">                                                                                                                             general_area_of_coverage <span class="op">==</span><span class="st"> &#39;na&#39;</span>, <span class="ot">NA</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">coverage_city =</span> <span class="kw">replace</span>(coverage_city, </a>
<a class="sourceLine" id="cb80-10" data-line-number="10">                                 coverage_city <span class="op">==</span><span class="st"> &#39;na&#39;</span>, <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb80-11" data-line-number="11"></a>
<a class="sourceLine" id="cb80-12" data-line-number="12">geocorrected =<span class="st"> </span>geocorrected <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lat =</span> <span class="kw">as.numeric</span>(lat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lng =</span> <span class="kw">as.numeric</span>(lng)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-15" data-line-number="15"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-16" data-line-number="16"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lng))</a></code></pre></div>
<p>Next, join these points to the title list, so that every title now has a set of lat/long coordinates.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">title_df =<span class="st"> </span>title_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(geocorrected) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(lng))</a></code></pre></div>
</div>
<div id="using-st_join-to-connect-the-title-list-to-the-shapefile" class="section level2">
<h2><span class="header-section-number">6.10</span> Using st_join to connect the title list to the shapefile</h2>
<p>To join this to the shapefile, we need to turn it in to an simple features item. To do this we need to specify the coordinates and the CRS. The resulting file will contain a new column called ‘geometry’, containing the lat/long coordaintes in the correct simple features format.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">st_title =<span class="st"> </span><span class="kw">st_as_sf</span>(title_df, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&#39;lng&#39;</span>, <span class="st">&#39;lat&#39;</span>))</a>
<a class="sourceLine" id="cb82-2" data-line-number="2"></a>
<a class="sourceLine" id="cb82-3" data-line-number="3">st_title =<span class="st"> </span>st_title  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_set_crs</span>(<span class="dv">4326</span>)</a></code></pre></div>
<p>Now, we can use a special kind of join, which will join the points in the title list, if they are within a particular polygon. The resulting dataset now has the relevant county, as found in the shapefile.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">st_counties =<span class="st"> </span><span class="kw">st_join</span>(st_title, gb1851)</a></code></pre></div>
<p>Make a new dataframe, containing just the counties and their counts.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">county_tally =<span class="st"> </span>st_counties <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(G_NAME) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(G_NAME) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb84-4" data-line-number="4"><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-5" data-line-number="5"><span class="st">  </span><span class="kw">st_drop_geometry</span>()</a></code></pre></div>
</div>
<div id="draw-using-ggplot2-and-geom_sf" class="section level2">
<h2><span class="header-section-number">6.11</span> Draw using ggplot2 and geom_sf()</h2>
<p>Join this to the shapefile we made earlier, which gives a dataset with the relevant counts attached to each polygon. This can then be visualised using the <code>geom_sf()</code> function from ggplot2, and all of ggplot2’s other features can be used.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">gb1851 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(county_tally) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">lwd =</span> <span class="fl">.2</span>,<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="kw">aes</span>(<span class="dt">fill =</span> n)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb85-6" data-line-number="6"><span class="st">  </span><span class="kw">lims</span>(<span class="dt">fill =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">4000</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&#39;plasma&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;British Library Newspaper</span><span class="ch">\n</span><span class="st">Titles, by County&quot;</span>, </a>
<a class="sourceLine" id="cb85-9" data-line-number="9">       <span class="dt">fill =</span> <span class="st">&#39;No. of Titles:&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;left&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>), </a>
<a class="sourceLine" id="cb85-12" data-line-number="12">        <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-99"></span>
<img src="_main_files/figure-html/unnamed-chunk-99-1.png" alt="Choropleth Made with geom_sf()" width="768" />
<p class="caption">
Figure 6.7: Choropleth Made with geom_sf()
</p>
</div>
<p>Further reading:</p>
<p>The book ‘Geocomputation with R’ is a fantastic resource for learning about mapping: <a href="https://geocompr.robinlovelace.net" class="uri">https://geocompr.robinlovelace.net</a>. It’s surprisinly easy to read even though it goes through some pretty advanced topics.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="quick-introduction-to-r-and-the-tidyverse.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="download-and-unzip-newspaper-files-using-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
